<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title> - jsFiddle demo by jhaRoshan</title>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>


    <script type="text/javascript" src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css">

    <link rel="stylesheet" type="text/css" href="/css/result-light.css">


    <script type="text/javascript" src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.7.2.min.js"></script>


    <style type="text/css">
        #container {
            border: solid 1px #ccc;
            width: 600px;
            height: 600px;
            position: absolute;
            left: 330px;
            top: 10px;
        }

        .wrapper {
            width: 300px;
        }

        #accordion-resizer {
            width: 300px;
            height: 400px;
            margin-top: 10px;
        }

        .room {
            width: 100px;
            border: 4px solid black;
            height: 60px;
            position: relative;
            z-index: 1;
            background-color: ivory;
        }

        .imag {
            width: 32px;
            height: 32px;
            position: relative;
            z-index: 2;
        }
    </style>


    <script type="text/javascript">//<![CDATA[
    $(window).load(function () {
// drawing the accordion
        $("#accordion").accordion({
            heightStyle: "fill"
        });
// get a reference to the house icon
        var $house = $(".imag");

// get the offset position of the kinetic container
        var $stageContainer = $("#container");
        var stageOffset = $stageContainer.offset();
        var offsetX = stageOffset.left;
        var offsetY = stageOffset.top;

// create the Kinetic.Stage and layer
        var stage = new Kinetic.Stage({
            container: 'container',
            width: 600,
            height: 600
        });

// grid data
        var CELL_SIZE = 40,
                w = 15,
                h = 15,
                W = w * CELL_SIZE,
                H = h * CELL_SIZE;

// function of drawing the grid in the container
        var make_grid = function (layer) {
            var r = new Kinetic.Rect({
                x: 0,
                y: 0,
                width: W,
                height: H,
                fill: "white"
            });
            layer.add(r);
            for (i = 0; i < w + 1; i++) {
                var I = i * CELL_SIZE;
                var l = new Kinetic.Line({
                    stroke: "grey",
                    strokeWidth: 0.5,
                    points: [I, 0, I, H]
                });
                layer.add(l);
            }

            for (j = 0; j < h + 1; j++) {
                var J = j * CELL_SIZE;
                var l2 = new Kinetic.Line({
                    stroke: "grey",
                    strokeWidth: 0.5,
                    points: [0, J, W, J]
                });
                layer.add(l2);
            }
            return r;
        };

        var layer = new Kinetic.Layer();
//var chambre = new Kinetic.Group();
        var rect = new Kinetic.Rect({
            x: 0,
            y: 0,
            width: CELL_SIZE,
            height: CELL_SIZE,
            fill: "white",
            stroke: "grey",
            strokeWidth: 0.5
        });
        var gr = make_grid(layer);

// add the shape to the layer
        layer.add(rect);
// add the layer to the stage
        stage.add(layer);

        /************************************/
        function Picture(x, y, name, url, eqpt_id) {
            this.x = x;
            this.y = y;
            this.name = name;
            this.url = url;
            this.id = "#house_" + eqpt_id;
        }

        /*Pictures = [{"x": Picture.x,
         "y": Picture.y,
         "name": Picture.name,
         "url": Picture.url,
         "eqpt_id": Picture.eqpt_id
         }];*/
        var image1 = new Picture(null, null, "television", "tv.png", 1);
        var xi = image1.x;
        /************************************/


//create a group
        var group = new Kinetic.Group({
            draggable: true //make group draggable
        });
        var rec = new Kinetic.Rect({
            x: 10,
            y: 330,
            width: 600,
            height: 600

        });
        group.add(rec);
        //return group;
        group.on('mouseover', function () {
            document.body.style.cursor = 'pointer';
        });
        group.on('mouseout', function () {
            document.body.style.cursor = 'default';
        });
        layer.add(group);
        stage.add(layer);

// make the images draggable
        $house.draggable({
            helper: 'clone',
            cursor: 'pointer',
            revert: 'invalid'
        });
        $(".room").draggable({
            helper: 'clone',
            cursor: 'pointer',
            revert: 'invalid'
        });

// make the Kinetic Container a dropzone
        $stageContainer.droppable({
            drop: dragDrop
        });

// handle a drop into the Kinetic container
        function dragDrop(e, ui) {
            // get the drop point
            var x = parseInt(ui.offset.left - offsetX, 10);
            var y = parseInt(ui.offset.top - offsetY, 10);

            // get the drop payload (here the payload is the image)
            var element = ui.draggable;
            var data = element.data("url");
            var theImage = element.data("image");

            // create a new Kinetic.Image at the drop point
            // be sure to adjust for any border width (here border==1)
            var image = new Kinetic.Image({
                name: data,
                x: x,
                y: y,
                image: theImage,
                draggable: true
            });

            image.on('dblclick', function () {
                image.remove();
                layer.draw();
            });

            var $clone = ui.helper.clone();
            // all clones are draggable
            // if clone is shape then draggable + resizable
            if (!$clone.is('.inside-droppable')) {
                $(this).append($clone.addClass('inside-droppable').draggable({
                    containment: $stageContainer,
                    tolerance: 'fit',
                    cursor: 'pointer',
                    position: 'relative'
                }));

                if ($clone.is(".imag") === false) {
                    $clone.resizable({
                        containment: $stageContainer
                    });
                }
                $clone.on('dblclick', function () {
                    $clone.remove();
                    layer.draw();
                });
                $clone.css({top: y, left: x, position: 'absolute'});
            }
            group.add(image);
            layer.add(group);
            stage.add(layer);
        }
    });//]]>

    </script>


</head>
<body style="cursor: default;">
<div id="container" class="ui-droppable">
    <div class="kineticjs-content" style="position: relative; display: inline-block; width: 600px; height: 600px;">
        <canvas width="600" height="600"
                style="padding: 0px; margin: 0px; border: 0px; position: absolute; top: 0px; left: 0px; width: 600px; height: 600px; background: transparent;"></canvas>
    </div>
    <div class="room ui-draggable ui-draggable-dragging inside-droppable ui-resizable"
         style="position: absolute; left: 249px; top: 133px;">
        <div class="ui-resizable-handle ui-resizable-e" style="z-index: 1000;"></div>
        <div class="ui-resizable-handle ui-resizable-s" style="z-index: 1000;"></div>
        <div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se"
             style="z-index: 1000;"></div>
    </div>
    <img class="imag ui-draggable inside-droppable" src="http://sandbox.kendsnyder.com/IM/square-stripped.png"
         style="position: absolute; left: 166px; top: 159px;"><img
        class="imag ui-draggable ui-draggable-dragging inside-droppable"
        src="http://sandbox.kendsnyder.com/IM/square-stripped.png" style="position: absolute; left: 214px; top: 236px;"><img
        class="imag ui-draggable ui-draggable-dragging inside-droppable" width="32" height="32"
        src="http://t3.gstatic.com/images?q=tbn:ANd9GcRBYkAv40Eeaxlze2dqhayvKUeoUH6l_jYNLlsfjzJu0Uy9ucjcNA"
        style="position: absolute; left: 162px; top: 299px;"></div>
<div id="accordion-resizer">
    <div id="accordion" class="wrapper ui-accordion ui-widget ui-helper-reset" role="tablist">

        <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-accordion-header-active ui-state-active ui-corner-top"
            role="tab" id="ui-accordion-accordion-header-0" aria-controls="ui-accordion-accordion-panel-0"
            aria-selected="true" tabindex="0"><span
                class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s"></span>Build</h3>

        <div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active"
             id="ui-accordion-accordion-panel-0" aria-labelledby="ui-accordion-accordion-header-0" role="tabpanel"
             aria-expanded="true" aria-hidden="false"
             style="display: block; height: 230.799999237061px; overflow: auto;">
            <p>
                List of building features
            </p>

            <div class="room ui-draggable"></div>
            <p></p>
        </div>

        <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-corner-all" role="tab"
            id="ui-accordion-accordion-header-1" aria-controls="ui-accordion-accordion-panel-1" aria-selected="false"
            tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Equipments</h3>

        <div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom"
             id="ui-accordion-accordion-panel-1" aria-labelledby="ui-accordion-accordion-header-1" role="tabpanel"
             aria-expanded="false" aria-hidden="true"
             style="display: none; height: 230.799999237061px; overflow: auto;">
            <p>
                List of equimpents' icons
            </p>

            <div>
                <img id="house_1" class="imag ui-draggable" src="http://sandbox.kendsnyder.com/IM/square-stripped.png">
                <img id="house_2" class="imag ui-draggable" width="32" height="32"
                     src="http://t3.gstatic.com/images?q=tbn:ANd9GcRBYkAv40Eeaxlze2dqhayvKUeoUH6l_jYNLlsfjzJu0Uy9ucjcNA">
            </div>

        </div>

        <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-corner-all ui-accordion-icons" role="tab"
            id="ui-accordion-accordion-header-2" aria-controls="ui-accordion-accordion-panel-2" aria-selected="false"
            tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Sensors</h3>

        <div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom"
             id="ui-accordion-accordion-panel-2" aria-labelledby="ui-accordion-accordion-header-2" role="tabpanel"
             aria-expanded="false" aria-hidden="true"
             style="display: none; height: 230.799999237061px; overflow: auto;">
            <p>
                List of sensors' icons
            </p>
        </div>
    </div>
</div>


</body>
</html>